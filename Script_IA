import os
import PyPDF2
import openai

# Configurar tu clave de API de OpenAI como variable de entorno
openai.api_key = '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'

def extraer_texto_desde_pdf(archivo_pdf):
    with open(archivo_pdf, 'rb') as file:
        pdf_reader = PyPDF2.PdfReader(file)
        texto = ''
        for page_num in range(len(pdf_reader.pages)):
            page = pdf_reader.pages[page_num]
            texto += page.extract_text()
    return texto

def resumir_texto(texto):
    # Fast prompting: Simplificar el prompt para una respuesta más rápida.
    # En lugar de proporcionar un prompt completo, solo damos la información esencial.
    prompt = f"Resumir: {texto[:500]}"

    respuesta_openai = openai.ChatCompletion.create(
        model='gpt-3.5-turbo',  # Utilizamos el modelo 'gpt-3.5-turbo'
        messages=[
            {"role": "system", "content": "You are a helpful assistant."},
            {"role": "user", "content": prompt}
        ]
    )
    
    # Accede al texto generado desde la respuesta
    resumen = respuesta_openai['choices'][0]['message']['content'].strip()
    return resumen

def realizar_consulta(texto):
    while True:
        consulta = input("Ingrese su consulta sobre el texto: ")

        # Incorporar la consulta en el prompt
        prompt = f"{texto} Consulta: {consulta}"

        # Obtener respuesta a la consulta
        respuesta_openai = openai.ChatCompletion.create(
            model='gpt-3.5-turbo',
            messages=[
                {"role": "system", "content": "You are a helpful assistant."},
                {"role": "user", "content": prompt}
            ]
        )

        # Mostrar la respuesta
        print(f"Respuesta a la consulta:\n{respuesta_openai['choices'][0]['message']['content'].strip()}")

        # Preguntar si desea hacer otra consulta
        respuesta_usuario = input("¿Desea realizar otra consulta? (S/N): ")
        if respuesta_usuario.upper() != 'S':
            break

# Ruta al archivo PDF
archivo_pdf = 'C:\\Users\\Leandro Abraham\\Desktop\\Gato_con_botas.pdf'

# Extraer texto del PDF
texto_extraido = extraer_texto_desde_pdf(archivo_pdf)

# Obtener resumen del texto
resumen_texto = resumir_texto(texto_extraido)

# Imprimir resultado del resumen
print(f"Resumen del texto:\n{resumen_texto}")

# Realizar consultas sobre el texto
realizar_consulta(texto_extraido)

# Mensaje de despedida
print("¡Tenga buen día!")


